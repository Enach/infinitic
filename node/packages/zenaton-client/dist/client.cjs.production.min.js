"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("pulsar-client"),r=require("@zenaton/messages"),t=require("uuid");exports.Client=class{constructor(e={}){this.opts=Object.assign({pulsar:{client:{}}},e)}dispatchTask(e,r){try{const s=this,n=t.v4(),o={jobId:n,type:"DispatchJob",DispatchJob:{jobId:n,sentAt:Date.now(),jobName:e,jobData:Buffer.from(JSON.stringify(r)),workflowId:null}};return s.dispatchForEngineMessage(o),Promise.resolve()}catch(e){return Promise.reject(e)}}dispatchForEngineMessage(t){try{const n=this;function s(){return Promise.resolve(n.pulsarProducer.send({data:r.AvroForEngineMessage.toBuffer(t)})).then((function(){}))}n.pulsarClient||(n.pulsarClient=new e.Client(n.opts.pulsar.client));const o=function(){if(!n.pulsarProducer)return Promise.resolve(n.pulsarClient.createProducer({topic:"persistent://public/default/tasks-engine",sendTimeoutMs:3e4,batchingEnabled:!1})).then((function(e){n.pulsarProducer=e}))}();return Promise.resolve(o&&o.then?o.then(s):s())}catch(e){return Promise.reject(e)}}};
//# sourceMappingURL=client.cjs.production.min.js.map
